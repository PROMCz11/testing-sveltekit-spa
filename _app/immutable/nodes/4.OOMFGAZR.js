import{s as k,n as r,o as v}from"../chunks/scheduler.CtbWrGNo.js";import{S as y,i as T,e as C,c as b,k as x,l as E,g as L,d as S}from"../chunks/index.C4D7lu78.js";import{l as U}from"../chunks/new-logo.DsdXLF4Y.js";import{e as $}from"../chunks/email-icon.rKPc7fMv.js";import{p as B}from"../chunks/preloader.DvsVy94I.js";function I(l){let t,i=`<img src="${U}" id="logo" alt=""/> <div id="confirm-instructions" class="svelte-llhcpf"><p>Check your email inbox to confirm your account</p> <img src="${$}" alt=""/> <input id="code-input" placeholder="Enter the code here..." type="text" class="svelte-llhcpf"/> <p class="confirmation-hint svelte-llhcpf">(Check the spam folder if you don&#39;t find the email)</p> <button id="resend-btn" class="svelte-llhcpf">Resend code</button> <a href="login" class="svelte-llhcpf">Back to the log in page</a></div> <div id="confirm-authentication" class="hide svelte-llhcpf"><p>Authenticating</p> <img src="${B}" alt=""/></div>`;return{c(){t=C("div"),t.innerHTML=i,this.h()},l(n){t=b(n,"DIV",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-16yyvpc"&&(t.innerHTML=i),this.h()},h(){E(t,"class","body-confirmation svelte-llhcpf")},m(n,s){L(n,t,s)},p:r,i:r,o:r,d(n){n&&S(t)}}}function _(l){return v(()=>{const t=document.getElementById("confirm-instructions"),i=document.getElementById("confirm-authentication"),n=document.getElementById("code-input"),s=document.getElementById("resend-btn");function f(e){return/^\d{6}$/.test(e)}const d=()=>{t.classList.toggle("hide"),i.classList.toggle("hide")},p=e=>{document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT;"},u=()=>{if(f(n.value)){const e=n.value;d(),fetch("https://task-manager-back-end-7gbe.onrender.com/api/user/confirm",{method:"PATCH",body:JSON.stringify({confirm_key:e}),headers:{"Content-type":"application/json; charset=UTF-8",verifyUserToken:`Bearer ${m()}`}}).then(o=>o.json()).then(o=>{if(console.log(o),o.status){const c=o.data.authToken,a=new Date;a.setMonth(a.getMonth()+1),document.cookie=`authToken=${c}; expires=${a.toUTCString()}`,p("verifyUserToken"),window.location.href="app"}else alert(o.message),d()}).catch(o=>console.log(o))}else alert("Confirmation key must be six digits")};n.addEventListener("keydown",e=>{e.key==="Enter"&&u()});const h=()=>{Array.from(t.children).forEach(e=>{e.id!="resend-btn"&&e.nodeName!="A"&&e.classList.toggle("hide")})},m=()=>{const e=document.cookie.split("; ").find(c=>c.startsWith("verifyUserToken="));return e?e.split("=")[1]:null},g=()=>{s.classList.contains("active")||(s.textContent="Sending...",s.classList.add("active"),h(),fetch("https://task-manager-back-end-7gbe.onrender.com/api/user/resendotp",{method:"GET",headers:{"Content-type":"application/json; charset=UTF-8",verifyUserToken:`Bearer ${m()}`}}).then(e=>e.json()).then(e=>{e.status?(s.textContent="Code was resent",s.classList.remove("active"),h()):alert(e.message)}).catch(e=>console.log(e)))};s.addEventListener("click",g)}),[]}class H extends y{constructor(t){super(),T(this,t,_,I,k,{})}}export{H as component};
